"use strict";(self.webpackChunkwebsite_2=self.webpackChunkwebsite_2||[]).push([[185],{3370:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>o,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"documents/task_worker","title":"\u4efb\u52d9\u5de5\u4f5c\u8005\uff08TaskWorker\uff09\u8a73\u7d30\u8aaa\u660e","description":"TaskWorker \u662f Skalds \u7cfb\u7d71\u4e2d\u8ca0\u8cac\u5be6\u969b\u57f7\u884c\u4efb\u52d9\u7684\u6838\u5fc3\u5143\u4ef6\u3002\u6bcf\u500b TaskWorker \u4ee5\u7368\u7acb\u9032\u7a0b\u904b\u4f5c\uff0c\u5177\u5099\u5f48\u6027\u7684\u751f\u547d\u9031\u671f\u7ba1\u7406\u3001\u4e8b\u4ef6\u9a45\u52d5\u53c3\u6578\u66f4\u65b0\u3001\u8207 Kafka/Redis \u6574\u5408\u80fd\u529b\u3002\u958b\u767c\u8005\u53ef\u900f\u904e\u7e7c\u627f\u57fa\u790e\u985e\u5225\u8207\u8a3b\u518a\u81ea\u8a02\u8655\u7406\u5668\uff0c\u8f15\u9b06\u64f4\u5145\u8207\u5ba2\u88fd\u5316\u4efb\u52d9\u908f\u8f2f\u3002","source":"@site/docs/documents/task_worker.md","sourceDirName":"documents","slug":"/documents/task_worker","permalink":"/Skalds/docs/documents/task_worker","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"\u4efb\u52d9\u5de5\u4f5c\u8005\uff08TaskWorker\uff09"},"sidebar":"documentsSidebar","previous":{"title":"\u4efb\u52d9\u751f\u547d\u9031\u671f","permalink":"/Skalds/docs/documents/task_lifecycle"},"next":{"title":"YAML \u914d\u7f6e","permalink":"/Skalds/docs/documents/yaml_config"}}');var l=s(5813),d=s(9863);const i={sidebar_position:2,sidebar_label:"\u4efb\u52d9\u5de5\u4f5c\u8005\uff08TaskWorker\uff09"},c="\u4efb\u52d9\u5de5\u4f5c\u8005\uff08TaskWorker\uff09\u8a73\u7d30\u8aaa\u660e",t={},a=[{value:"\u8a2d\u8a08\u7406\u5ff5\u8207\u67b6\u69cb",id:"\u8a2d\u8a08\u7406\u5ff5\u8207\u67b6\u69cb",level:2},{value:"\u6838\u5fc3\u985e\u5225\u8207\u4ecb\u9762",id:"\u6838\u5fc3\u985e\u5225\u8207\u4ecb\u9762",level:2},{value:"1. \u62bd\u8c61\u57fa\u790e\u985e\u5225",id:"1-\u62bd\u8c61\u57fa\u790e\u985e\u5225",level:3},{value:"2. \u5be6\u4f5c\u57fa\u790e\u985e\u5225",id:"2-\u5be6\u4f5c\u57fa\u790e\u985e\u5225",level:3},{value:"\u751f\u547d\u9031\u671f\u8207\u904b\u4f5c\u6d41\u7a0b",id:"\u751f\u547d\u9031\u671f\u8207\u904b\u4f5c\u6d41\u7a0b",level:2},{value:"\u4e3b\u8981\u88dd\u98fe\u5668\uff08Decorators\uff09",id:"\u4e3b\u8981\u88dd\u98fe\u5668decorators",level:2},{value:"\u8cc7\u6599\u7d50\u69cb\u8207\u578b\u5225",id:"\u8cc7\u6599\u7d50\u69cb\u8207\u578b\u5225",level:2},{value:"Task \u5b9a\u7fa9\uff08\u4f86\u81ea <code>skalds/model/task.py</code>\uff09",id:"task-\u5b9a\u7fa9\u4f86\u81ea-skaldsmodeltaskpy",level:3},{value:"\u4efb\u52d9\u751f\u547d\u9031\u671f\u72c0\u614b\uff08TaskLifecycleStatus\uff09\u5217\u8868",id:"\u4efb\u52d9\u751f\u547d\u9031\u671f\u72c0\u614btasklifecyclestatus\u5217\u8868",level:4},{value:"TaskWorker \u8cc7\u6599\u6d41",id:"taskworker-\u8cc7\u6599\u6d41",level:3},{value:"\u81ea\u8a02 TaskWorker \u5be6\u4f5c\u7bc4\u4f8b",id:"\u81ea\u8a02-taskworker-\u5be6\u4f5c\u7bc4\u4f8b",level:2},{value:"1. \u5b9a\u7fa9\u8cc7\u6599\u6a21\u578b",id:"1-\u5b9a\u7fa9\u8cc7\u6599\u6a21\u578b",level:3},{value:"2. \u5be6\u4f5c\u81ea\u8a02 TaskWorker",id:"2-\u5be6\u4f5c\u81ea\u8a02-taskworker",level:3},{value:"3. YAML \u914d\u7f6e\u7bc4\u4f8b",id:"3-yaml-\u914d\u7f6e\u7bc4\u4f8b",level:3},{value:"4. \u8a3b\u518a\u8207\u555f\u52d5",id:"4-\u8a3b\u518a\u8207\u555f\u52d5",level:3},{value:"\u9032\u968e\u7279\u6027",id:"\u9032\u968e\u7279\u6027",level:2},{value:"\u53c3\u8003\u7bc4\u4f8b",id:"\u53c3\u8003\u7bc4\u4f8b",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"\u4efb\u52d9\u5de5\u4f5c\u8005taskworker\u8a73\u7d30\u8aaa\u660e",children:"\u4efb\u52d9\u5de5\u4f5c\u8005\uff08TaskWorker\uff09\u8a73\u7d30\u8aaa\u660e"})}),"\n",(0,l.jsx)(n.p,{children:"TaskWorker \u662f Skalds \u7cfb\u7d71\u4e2d\u8ca0\u8cac\u5be6\u969b\u57f7\u884c\u4efb\u52d9\u7684\u6838\u5fc3\u5143\u4ef6\u3002\u6bcf\u500b TaskWorker \u4ee5\u7368\u7acb\u9032\u7a0b\u904b\u4f5c\uff0c\u5177\u5099\u5f48\u6027\u7684\u751f\u547d\u9031\u671f\u7ba1\u7406\u3001\u4e8b\u4ef6\u9a45\u52d5\u53c3\u6578\u66f4\u65b0\u3001\u8207 Kafka/Redis \u6574\u5408\u80fd\u529b\u3002\u958b\u767c\u8005\u53ef\u900f\u904e\u7e7c\u627f\u57fa\u790e\u985e\u5225\u8207\u8a3b\u518a\u81ea\u8a02\u8655\u7406\u5668\uff0c\u8f15\u9b06\u64f4\u5145\u8207\u5ba2\u88fd\u5316\u4efb\u52d9\u908f\u8f2f\u3002"}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u8a2d\u8a08\u7406\u5ff5\u8207\u67b6\u69cb",children:"\u8a2d\u8a08\u7406\u5ff5\u8207\u67b6\u69cb"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u7368\u7acb\u9032\u7a0b"}),"\uff1a\u6bcf\u500b TaskWorker \u4ee5 multiprocessing.Process \u904b\u4f5c\uff0c\u78ba\u4fdd\u8cc7\u6e90\u9694\u96e2\u8207\u9ad8\u53ef\u9760\u6027\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5"}),"\uff1a\u652f\u63f4\u52d5\u614b\u53c3\u6578\u66f4\u65b0\u8207\u72c0\u614b\u540c\u6b65\uff0c\u900f\u904e Kafka/Redis \u5be6\u73fe\u5373\u6642\u901a\u8a0a\u8207\u5fc3\u8df3\u76e3\u63a7\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u751f\u547d\u9031\u671f\u9264\u5b50"}),"\uff1a\u63d0\u4f9b before\u3001main\u3001after\u3001release \u7b49\u591a\u968e\u6bb5\u9264\u5b50\uff0c\u5141\u8a31\u81ea\u8a02\u4efb\u52d9\u57f7\u884c\u6d41\u7a0b\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u578b\u5225\u5b89\u5168"}),"\uff1a\u521d\u59cb\u5316\u8207\u66f4\u65b0\u4e8b\u4ef6\u7686\u63a1\u7528 Pydantic BaseModel\uff0c\u78ba\u4fdd\u8cc7\u6599\u7d50\u69cb\u56b4\u8b39\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u6838\u5fc3\u985e\u5225\u8207\u4ecb\u9762",children:"\u6838\u5fc3\u985e\u5225\u8207\u4ecb\u9762"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u62bd\u8c61\u57fa\u790e\u985e\u5225",children:"1. \u62bd\u8c61\u57fa\u790e\u985e\u5225"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"AbstractTaskWorker[T]"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6cdb\u578b T \u70ba\u4efb\u52d9\u8cc7\u6599\u578b\u5225\uff08\u7e7c\u627f\u81ea Pydantic BaseModel\uff09\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["\u4e3b\u8981\u751f\u547d\u9031\u671f\u65b9\u6cd5\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"initialize(self, data: T)"}),": \u521d\u59cb\u5316\u4efb\u52d9\u8cc7\u6599\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_run_before(self)"}),": \u4efb\u52d9\u524d\u7f6e\u4f5c\u696d\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_run_main(self)"}),": \u4efb\u52d9\u4e3b\u908f\u8f2f\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_run_after(self)"}),": \u4efb\u52d9\u7d50\u675f\u5f8c\u8655\u7406\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_release(self, *args)"}),": \u8cc7\u6e90\u91cb\u653e\u8207\u7d42\u6b62\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_error_handler(self, exc)"}),": \u4f8b\u5916\u8655\u7406\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u652f\u63f4\u81ea\u8a02\u9264\u5b50\u8a3b\u518a\uff08\u898b\u4e0b\u65b9\u88dd\u98fe\u5668\uff09\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"2-\u5be6\u4f5c\u57fa\u790e\u985e\u5225",children:"2. \u5be6\u4f5c\u57fa\u790e\u985e\u5225"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"BaseTaskWorker[T]"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5be6\u4f5c Kafka/Redis \u6574\u5408\u3001\u5fc3\u8df3\u76e3\u63a7\u3001\u8a0a\u606f\u6d88\u8cbb\u3001\u932f\u8aa4\u56de\u5831\u7b49\u57fa\u790e\u8a2d\u65bd\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["\u4e3b\u8981\u5c6c\u6027\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"task_id"}),"\uff1a\u4efb\u52d9\u552f\u4e00\u8b58\u5225\u78bc\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"task_type"}),"\uff1a\u4efb\u52d9\u985e\u578b\uff08\u985e\u5225\u540d\u7a31\uff09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"dependencies"}),"\uff1a\u4efb\u52d9\u4f9d\u8cf4\u5217\u8868\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4e3b\u8981\u65b9\u6cd5\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_run_before"}),"\uff1a\u521d\u59cb\u5316 Kafka/Redis \u9023\u7dda\u3001\u555f\u52d5\u5fc3\u8df3\u8207\u8a0a\u606f\u6d88\u8cbb\u57f7\u884c\u7dd2\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"handle_update_message"}),"\uff1a\u8655\u7406\u4f86\u81ea Kafka \u7684\u4efb\u52d9\u66f4\u65b0\u4e8b\u4ef6\uff0c\u4e26\u547c\u53eb\u81ea\u8a02 handler\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_run_after"}),"\uff1a\u7d50\u675f\u5f8c\u505c\u6b62\u5fc3\u8df3\u4e26\u6a19\u8a18\u5b8c\u6210\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_error_handler"}),"\uff1a\u932f\u8aa4\u6642\u56de\u5831\u81f3 Redis \u4e26\u63a8\u9001\u5931\u6557\u5fc3\u8df3\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"_release"}),"\uff1a\u91cb\u653e\u6240\u6709\u8cc7\u6e90\u3001\u95dc\u9589\u9023\u7dda\u3001\u8655\u7406\u4fe1\u865f\u7d42\u6b62\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u751f\u547d\u9031\u671f\u8207\u904b\u4f5c\u6d41\u7a0b",children:"\u751f\u547d\u9031\u671f\u8207\u904b\u4f5c\u6d41\u7a0b"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u521d\u59cb\u5316"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Skalds \u7522\u751f\u4efb\u52d9\uff0c\u5efa\u7acb TaskWorker \u5be6\u9ad4\u4e26\u547c\u53eb ",(0,l.jsx)(n.code,{children:"initialize(data: T)"}),"\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u8a3b\u518a\u81ea\u8a02\u751f\u547d\u9031\u671f\u9264\u5b50\uff08\u5982 @run_main_handler\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u555f\u52d5\u8207\u524d\u7f6e\u4f5c\u696d"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u57f7\u884c ",(0,l.jsx)(n.code,{children:"_run_before"}),"\uff0c\u5efa\u7acb Kafka/Redis \u9023\u7dda\uff0c\u555f\u52d5\u5fc3\u8df3\u8207\u8a0a\u606f\u6d88\u8cbb\u57f7\u884c\u7dd2\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u4e3b\u908f\u8f2f\u57f7\u884c"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u57f7\u884c ",(0,l.jsx)(n.code,{children:"_run_main"})," \u6216\u81ea\u8a02 @run_main_handler\uff0c\u8655\u7406\u5be6\u969b\u4efb\u52d9\u5167\u5bb9\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u52d5\u614b\u53c3\u6578\u66f4\u65b0"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u900f\u904e Kafka \u63a5\u6536\u66f4\u65b0\u4e8b\u4ef6\uff0c\u547c\u53eb @update_event_handler \u8655\u7406\u65b0\u8cc7\u6599\uff0c\u5be6\u73fe\u71b1\u66f4\u65b0\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7d50\u675f\u8207\u6e05\u7406"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u57f7\u884c ",(0,l.jsx)(n.code,{children:"_run_after"}),"\uff0c\u505c\u6b62\u5fc3\u8df3\u3001\u6a19\u8a18\u5b8c\u6210\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u57f7\u884c ",(0,l.jsx)(n.code,{children:"_release"}),"\uff0c\u91cb\u653e\u8cc7\u6e90\u3001\u95dc\u9589\u9023\u7dda\u3001\u8655\u7406\u4fe1\u865f\u7d42\u6b62\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u932f\u8aa4\u8655\u7406"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4efb\u52d9\u7570\u5e38\u6642\uff0c\u57f7\u884c ",(0,l.jsx)(n.code,{children:"_error_handler"}),"\uff0c\u56de\u5831\u932f\u8aa4\u4e26\u63a8\u9001\u5931\u6557\u5fc3\u8df3\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u4e3b\u8981\u88dd\u98fe\u5668decorators",children:"\u4e3b\u8981\u88dd\u98fe\u5668\uff08Decorators\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@run_before_handler"}),"\uff1a\u8a3b\u518a\u524d\u7f6e\u4f5c\u696d\u9264\u5b50\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@run_main_handler"}),"\uff1a\u8a3b\u518a\u4e3b\u908f\u8f2f\u9264\u5b50\uff08\u5fc5\u9808\u5be6\u4f5c\uff09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@run_after_handler"}),"\uff1a\u8a3b\u518a\u7d50\u675f\u5f8c\u8655\u7406\u9264\u5b50\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@release_handler"}),"\uff1a\u8a3b\u518a\u8cc7\u6e90\u91cb\u653e\u9264\u5b50\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@update_event_handler"}),"\uff1a\u8a3b\u518a\u52d5\u614b\u53c3\u6578\u66f4\u65b0\u4e8b\u4ef6\u8655\u7406\u5668\uff0c\u578b\u5225\u5b89\u5168\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u8cc7\u6599\u7d50\u69cb\u8207\u578b\u5225",children:"\u8cc7\u6599\u7d50\u69cb\u8207\u578b\u5225"}),"\n",(0,l.jsxs)(n.h3,{id:"task-\u5b9a\u7fa9\u4f86\u81ea-skaldsmodeltaskpy",children:["Task \u5b9a\u7fa9\uff08\u4f86\u81ea ",(0,l.jsx)(n.a,{href:"https://github.com/JiHungLin/skalds/blob/main/skalds/model/task.py",children:(0,l.jsx)(n.code,{children:"skalds/model/task.py"})}),"\uff09"]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6b04\u4f4d\u540d\u7a31"}),(0,l.jsx)(n.th,{children:"\u578b\u5225"}),(0,l.jsx)(n.th,{children:"\u8aaa\u660e"}),(0,l.jsx)(n.th,{children:"\u7bc4\u4f8b"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"id"}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u4efb\u52d9\u552f\u4e00\u8b58\u5225\u78bc"}),(0,l.jsx)(n.td,{children:'"task_123"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"class_name"}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u5c0d\u61c9 TaskWorker \u985e\u5225\u540d\u7a31"}),(0,l.jsx)(n.td,{children:'"MyWorker"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"source"}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u4efb\u52d9\u4f86\u6e90\uff08\u5982 YAML\u3001MongoDB\uff09"}),(0,l.jsx)(n.td,{children:'"YAML"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"name"}),(0,l.jsx)(n.td,{children:"Optional[str]"}),(0,l.jsx)(n.td,{children:"\u4efb\u52d9\u540d\u7a31\uff08\u53ef\u9078\uff09"}),(0,l.jsx)(n.td,{children:'"\u5f71\u50cf\u5206\u6790\u4efb\u52d9"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"description"}),(0,l.jsx)(n.td,{children:"Optional[str]"}),(0,l.jsx)(n.td,{children:"\u4efb\u52d9\u63cf\u8ff0\uff08\u53ef\u9078\uff09"}),(0,l.jsx)(n.td,{children:'"\u8655\u7406 RTSP \u5f71\u50cf\u6d41"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"executor"}),(0,l.jsx)(n.td,{children:"Optional[str]"}),(0,l.jsx)(n.td,{children:"\u57f7\u884c\u8005\uff08\u5982 skalds ID\uff0c\u53ef\u9078\uff09"}),(0,l.jsx)(n.td,{children:'"skalds-1"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"dependencies"}),(0,l.jsx)(n.td,{children:"Optional[List[str]]"}),(0,l.jsx)(n.td,{children:"\u4f9d\u8cf4\u4efb\u52d9 ID \u5217\u8868\uff08\u53ef\u9078\uff09"}),(0,l.jsx)(n.td,{children:'["task_001", "task_002"]'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"mode"}),(0,l.jsx)(n.td,{children:"ModeEnum"}),(0,l.jsx)(n.td,{children:"\u57f7\u884c\u6a21\u5f0f\uff08Active/Passive\uff09"}),(0,l.jsx)(n.td,{children:'"Active"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"create_date_time"}),(0,l.jsx)(n.td,{children:"int"}),(0,l.jsx)(n.td,{children:"\u5efa\u7acb\u6642\u9593\uff08\u6beb\u79d2\uff09"}),(0,l.jsx)(n.td,{children:"1724131200000"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"update_date_time"}),(0,l.jsx)(n.td,{children:"int"}),(0,l.jsx)(n.td,{children:"\u6700\u5f8c\u66f4\u65b0\u6642\u9593\uff08\u6beb\u79d2\uff09"}),(0,l.jsx)(n.td,{children:"1724131300000"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"deadline_date_time"}),(0,l.jsx)(n.td,{children:"int"}),(0,l.jsx)(n.td,{children:"\u622a\u6b62\u6642\u9593\uff08\u6beb\u79d2\uff09"}),(0,l.jsx)(n.td,{children:"1724736000000"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"lifecycle_status"}),(0,l.jsx)(n.td,{children:"TaskLifecycleStatus"}),(0,l.jsx)(n.td,{children:"\u4efb\u52d9\u751f\u547d\u9031\u671f\u72c0\u614b"}),(0,l.jsx)(n.td,{children:'"Running"'})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"is_persistent"}),(0,l.jsx)(n.td,{children:"bool"}),(0,l.jsxs)(n.td,{children:["\u662f\u5426\u70ba\u5e38\u99d0\u4efb\u52d9\uff0c\u50c5\u5728 ",(0,l.jsx)(n.code,{children:"single_process"})," \u6a21\u5f0f\u4e0b\u751f\u6548\uff1b",(0,l.jsx)(n.code,{children:"true"})," \u8868\u793a\u5e38\u99d0\uff08\u985e\u4f3c Deployment\uff09\uff0c",(0,l.jsx)(n.code,{children:"false"})," \u8868\u793a\u4e00\u6b21\u6027\u4efb\u52d9\uff08\u985e\u4f3c Job/CronJob\uff09"]}),(0,l.jsx)(n.td,{children:"true"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"priority"}),(0,l.jsx)(n.td,{children:"int"}),(0,l.jsx)(n.td,{children:"\u512a\u5148\u6b0a\uff080~10\uff0c\u9810\u8a2d0\uff09"}),(0,l.jsx)(n.td,{children:"5"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"attachments"}),(0,l.jsx)(n.td,{children:"Optional[BaseModel]"}),(0,l.jsx)(n.td,{children:"\u4efb\u52d9\u53c3\u6578\uff08Pydantic BaseModel \u5be6\u4f8b\uff0c\u4f9d\u4efb\u52d9\u985e\u578b\u81ea\u8a02\uff09"}),(0,l.jsx)(n.td,{children:'MyDataModel(rtsp_url="...", fix_frame=10)'})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u4efb\u52d9\u751f\u547d\u9031\u671f\u72c0\u614btasklifecyclestatus\u5217\u8868",children:"\u4efb\u52d9\u751f\u547d\u9031\u671f\u72c0\u614b\uff08TaskLifecycleStatus\uff09\u5217\u8868"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Created"}),"\uff1a\u4efb\u52d9\u5df2\u5efa\u7acb\uff0c\u5c1a\u672a\u5206\u914d"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Assigning"}),"\uff1a\u4efb\u52d9\u5206\u914d\u4e2d"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Running"}),"\uff1a\u4efb\u52d9\u57f7\u884c\u4e2d"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Paused"}),"\uff1a\u4efb\u52d9\u66ab\u505c"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Finished"}),"\uff1a\u4efb\u52d9\u5df2\u5b8c\u6210"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Failed"}),"\uff1a\u4efb\u52d9\u57f7\u884c\u5931\u6557"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cancelled"}),"\uff1a\u4efb\u52d9\u5df2\u53d6\u6d88"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"taskworker-\u8cc7\u6599\u6d41",children:"TaskWorker \u8cc7\u6599\u6d41"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u521d\u59cb\u5316\u8207\u66f4\u65b0\u7686\u4ee5 ",(0,l.jsx)(n.code,{children:"attachments"})," \u6b04\u4f4d\u50b3\u905e\uff0c\u78ba\u4fdd\u578b\u5225\u4e00\u81f4\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u4efb\u52d9\u72c0\u614b\u3001\u5fc3\u8df3\u3001\u932f\u8aa4\u8a0a\u606f\u7686\u540c\u6b65\u81f3 Redis\uff0c\u4e26\u53ef\u7531 System Controller \u76e3\u63a7\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u81ea\u8a02-taskworker-\u5be6\u4f5c\u7bc4\u4f8b",children:"\u81ea\u8a02 TaskWorker \u5be6\u4f5c\u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u5b9a\u7fa9\u8cc7\u6599\u6a21\u578b",children:"1. \u5b9a\u7fa9\u8cc7\u6599\u6a21\u578b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from pydantic import BaseModel, Field, ConfigDict\n\nclass MyDataModel(BaseModel):\n    rtsp_url: str = Field(..., description="RTSP stream URL", alias="rtspUrl")\n    fix_frame: int = Field(..., description="Fix frame number", alias="fixFrame")\n    model_config = ConfigDict(populate_by_name=True, use_enum_values=True)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u5be6\u4f5c\u81ea\u8a02-taskworker",children:"2. \u5be6\u4f5c\u81ea\u8a02 TaskWorker"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from skalds.worker.baseclass import BaseTaskWorker, run_before_handler, run_main_handler, update_event_handler\nfrom skalds.utils.logging import logger\n\nclass MyWorker(BaseTaskWorker[MyDataModel]):\n    def initialize(self, data: MyDataModel) -> None:\n        self.rtsp_url = data.rtsp_url\n        self.fix_frame = data.fix_frame\n\n    @run_before_handler\n    def before_run(self) -> None:\n        logger.info(f"Starting MyWorker with RTSP URL: {self.rtsp_url}")\n\n    @run_main_handler\n    def main_run(self) -> None:\n        for _ in range(10):\n            logger.info(f"RTSP URL: {self.rtsp_url}, Fix Frame: {self.fix_frame}")\n            time.sleep(1)\n\n    @update_event_handler\n    def update_event(self, event_data: MyDataModel) -> None:\n        logger.info(f"Updating event for MyWorker with data: {event_data}")\n        self.rtsp_url = event_data.rtsp_url\n        self.fix_frame = event_data.fix_frame\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-yaml-\u914d\u7f6e\u7bc4\u4f8b",children:"3. YAML \u914d\u7f6e\u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"TaskWorkers:\n  TaskWorker1:\n    isPersistent: true\n    attachments:\n      fixFrame: 30\n      rtspUrl: rtsp://192.168.1.1/camera1\n    className: MyWorker\n"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"isPersistent"})," \u50c5\u5728 ",(0,l.jsx)(n.code,{children:"single_process"})," \u6a21\u5f0f\u4e0b\u751f\u6548\uff0c\u6c7a\u5b9a\u4efb\u52d9\u662f\u5426\u5e38\u99d0\uff08\u5c0d\u61c9 Deployment\uff09\u6216\u4e00\u6b21\u6027\uff08\u9069\u5408 Job/CronJob\uff09\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-\u8a3b\u518a\u8207\u555f\u52d5",children:"4. \u8a3b\u518a\u8207\u555f\u52d5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from skalds import Skalds\nfrom skalds.config.skald_config import SkaldConfig\n\nconfig = SkaldConfig(\n    skald_mode="edge",\n    yaml_file="all_workers.yml",\n    redis_host="localhost",\n    kafka_host="127.0.0.1",\n    mongo_host="mongodb://root:root@localhost:27017/"\n)\n\napp = Skalds(config)\napp.register_task_worker(MyWorker)\napp.run()\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u9032\u968e\u7279\u6027",children:"\u9032\u968e\u7279\u6027"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u591a\u968e\u6bb5\u4efb\u52d9\u8207\u91cd\u8a66"}),"\uff1a\u53ef\u81ea\u8a02 main handler \u652f\u63f4\u591a\u968e\u6bb5\u57f7\u884c\u8207\u5931\u6557\u91cd\u8a66\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u52d5\u614b\u53c3\u6578\u71b1\u66f4\u65b0"}),"\uff1a@update_event_handler \u652f\u63f4\u4efb\u52d9\u57f7\u884c\u4e2d\u5373\u6642\u8abf\u6574\u53c3\u6578\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4f8b\u5916\u8207\u7d42\u6b62\u8655\u7406"}),"\uff1a\u81ea\u8a02 _error_handler \u8207 _release \u53ef\u7cbe\u7d30\u63a7\u5236\u7570\u5e38\u8207\u8cc7\u6e90\u91cb\u653e\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4f9d\u8cf4\u7ba1\u7406"}),"\uff1aTask \u652f\u63f4 dependencies \u6b04\u4f4d\uff0c\u5be6\u73fe\u4efb\u52d9\u9593\u4f9d\u8cf4\u8207\u9806\u5e8f\u63a7\u5236\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u53c3\u8003\u7bc4\u4f8b",children:"\u53c3\u8003\u7bc4\u4f8b"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"../../examples/single_task_worker_define/",children:(0,l.jsx)(n.code,{children:"examples/single_task_worker_define/"})})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"../../examples/single_task_worker_with_skald_node/",children:(0,l.jsx)(n.code,{children:"examples/single_task_worker_with_skald_node/"})})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"../../examples/update_task_worker_with_skald_node/",children:(0,l.jsx)(n.code,{children:"examples/update_task_worker_with_skald_node/"})})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"TaskWorker \u67b6\u69cb\u8b93\u958b\u767c\u8005\u80fd\u4ee5\u6700\u5c0f\u6210\u672c\u64f4\u5145\u4efb\u52d9\u908f\u8f2f\uff0c\u4e26\u4eab\u6709\u9ad8\u53ef\u9760\u3001\u53ef\u76e3\u63a7\u3001\u6613\u7dad\u8b77\u7684\u5206\u6563\u5f0f\u4efb\u52d9\u57f7\u884c\u74b0\u5883\u3002"})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},9863:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(9729);const l={},d=r.createContext(l);function i(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);